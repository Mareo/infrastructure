---
apiVersion: acid.zalan.do/v1
kind: postgresql
metadata:
  name: in-cluster-main-cluster
  annotations:
    argocd.argoproj.io/sync-options: SkipDryRunOnMissingResource=true
spec:
  teamId: in-cluster
  volume:
    size: 10Gi
    storageClass: csi-rbd-sc-retain
  numberOfInstances: 1

  # users: name -> permissions (usually [])
  users:
    authentik.authentik: []
    gitlab.gitlab: []
    hedgedoc.hedgedoc: []
    nextcloud.nextcloud: []
    petitstream-dev.petitstream-dev: []
    petitstream.petitstream: []
    vaultwarden.vaultwarden: []

  # databases: name -> owner
  databases:
    authentik: authentik.authentik
    gitlab: gitlab.gitlab
    hedgedoc: hedgedoc.hedgedoc
    nextcloud: nextcloud.nextcloud
    petitstream: petitstream.petitstream
    petitstream_dev: petitstream-dev.petitstream-dev
    vaultwarden: vaultwarden.vaultwarden

  postgresql:
    version: "14"

  additionalVolumes:
    - name: pgbackup
      mountPath: /home/postgres/pgbackup
      volumeSource:
        emptyDir: {}

  resources:
    requests:
      cpu: 100m
      memory: 500Mi
    limits:
      cpu: "1"
      memory: 1Gi
